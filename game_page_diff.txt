<<<<<<< SEARCH
  useEffect(() => {
    if (!game || game.status !== 'waiting') {
      setWaitingRoomSecondsLeft(null)
      return
    }
    const deadline = new Date(game.created_at).getTime() + WAITING_ROOM_TIMEOUT_MS
    const update = () => {
      const left = Math.ceil((deadline - Date.now()) / 1000)
      if (left <= 0) {
        if (playerColor) {
          router.push('/')
        }
        setWaitingRoomSecondsLeft(0)
        return
      }
      setWaitingRoomSecondsLeft(left)
    }
    update()
    const interval = setInterval(update, 1000)
    return () => clearInterval(interval)
  }, [game?.status, game?.created_at, playerColor, router])
=======
  useEffect(() => {
    if (!game || game.status !== 'waiting') {
      const timeoutId = setTimeout(() => setWaitingRoomSecondsLeft(null), 0)
      return () => clearTimeout(timeoutId)
    }
    const deadline = new Date(game.created_at).getTime() + WAITING_ROOM_TIMEOUT_MS
    const update = () => {
      const left = Math.ceil((deadline - Date.now()) / 1000)
      if (left <= 0) {
        if (playerColor) {
          router.push('/')
        }
        setWaitingRoomSecondsLeft(0)
        return
      }
      setWaitingRoomSecondsLeft(left)
    }

    // Initial update deferred to avoid synchronous setState during render
    const timeoutId = setTimeout(update, 0)
    const interval = setInterval(update, 1000)

    return () => {
      clearTimeout(timeoutId)
      clearInterval(interval)
    }
  }, [game, playerColor, router])
>>>>>>> REPLACE
